<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>80mm Receipt Editor</title>

<link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@300;400;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
  :root {
    --width: 80mm;
  }
  body {
    font-family: "Roboto Mono", monospace;
    background: #f1f1f1;
    color: #000;
    margin: 0;
    display: flex;
    justify-content: center;
    padding: 10px;
  }

  .container {
    display: flex;
    gap: 20px;
    max-width: 1200px;
    width: 100%;
  }

  .editor {
    width: 340px;
    background: #fff;
    padding: 16px;
    border-radius: 6px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }

  .receipt {
    width: var(--width);
    background: #fff;
    color: #000;
    font-size: 12px;
    line-height: 1.2;
    padding: 8px 6px;
    border: 1px solid #ddd;
    box-sizing: border-box;
  }

  @media print {
    body {
      background: #fff;
      margin: 0;
      padding: 0;
    }
    .editor { display: none; }
    .receipt {
      border: none;
      width: 80mm;
      margin: 0;
      padding: 0;
    }
  }

  .center { text-align: center; }
  .sep { border-top: 1px dashed #000; margin: 6px 0; }
  .line { display: flex; justify-content: space-between; font-size: 12px; }
  .muted { font-size: 10px; color: #333; }
  .logo-img { max-height: 45px; display: block; margin: 0 auto 4px auto; }

  input, textarea, select, button {
    font-family: inherit;
    font-size: 12px;
    width: 100%;
    margin: 3px 0;
    padding: 6px;
    box-sizing: border-box;
  }

  button { background: #000; color: #fff; border: none; border-radius: 4px; cursor: pointer; }
  .items div { display: flex; gap: 4px; align-items: center; margin-bottom: 3px; }
  .items input { flex: 1; }
  .remove { background: #b33; color: #fff; border-radius: 4px; padding: 4px 6px; cursor: pointer; }
</style>
</head>
<body>

<div class="container">
  <div class="editor">
    <h3>Receipt Setup (80mm)</h3>

    <label>Logo (optional)</label>
    <input id="logoInput" type="file" accept="image/*">

    <label>Shopname</label>
    <input id="shopName" value="My Store">

    <label>Adresse</label>
    <textarea id="address" rows="2">123 Example Street
City, ST 12345</textarea>

    <label>Telefon / Website</label>
    <input id="contact" value="(555) 123-4567 ‚Ä¢ www.example.com">

    <label>Kunde</label>
    <input id="customer" value="John Doe">

    <label>Datum</label>
    <input id="date" type="date">
    <label>Uhrzeit</label>
    <input id="time" type="time">

    <label>Transaktions-ID</label>
    <input id="transId" value="TRX-20251024-001">

    <div class="items" id="items"></div>
    <button id="addItem">+ Artikel</button>

    <label>Steuer (%)</label>
    <input id="tax" type="number" value="8">

    <label>W√§hrung</label>
    <input id="currency" value="$">

    <button id="printBtn">üñ®Ô∏è Drucken</button>
    <button id="pdfBtn">‚¨áÔ∏è PDF</button>
  </div>

  <div class="receipt" id="receipt">
    <img id="logoPreview" class="logo-img" style="display:none">
    <div class="center" id="rShop">My Store</div>
    <div class="center" id="rAddr">123 Example Street<br>City, ST 12345</div>
    <div class="center muted" id="rContact">(555) 123-4567 ‚Ä¢ www.example.com</div>
    <div class="sep"></div>
    <div class="line"><div id="rDate"></div><div id="rTime"></div></div>
    <div class="sep"></div>
    <div>Kunde: <span id="rCustomer"></span></div>
    <div class="sep"></div>
    <div id="rItems"></div>
    <div class="sep"></div>
    <div class="line"><div>Subtotal</div><div id="rSubtotal">$0.00</div></div>
    <div class="line"><div>Steuer</div><div id="rTax">$0.00</div></div>
    <div class="line" style="font-weight:bold;"><div>Total</div><div id="rTotal">$0.00</div></div>
    <div class="sep"></div>
    <div class="center muted">Transaktion: <span id="rTrans"></span></div>
    <div class="center muted" style="margin-top:4px;">Danke f√ºr Ihren Einkauf!</div>
  </div>
</div>

<script>
const $ = id => document.getElementById(id);
let items = [{ name: "Produkt A", qty: 1, price: 9.99 }];

function renderItemsForm() {
  const list = $("items");
  list.innerHTML = "";
  items.forEach((it, i) => {
    const div = document.createElement("div");
    div.innerHTML = `
      <input value="${it.name}" data-i="${i}" class="name">
      <input type="number" value="${it.qty}" step="1" data-i="${i}" class="qty" style="width:50px">
      <input type="number" value="${it.price}" step="0.01" data-i="${i}" class="price" style="width:70px">
      <span class="remove" data-i="${i}">‚úï</span>
    `;
    list.appendChild(div);
  });
  list.querySelectorAll(".name").forEach(el => el.oninput = e => { items[e.target.dataset.i].name = e.target.value; updatePreview(); });
  list.querySelectorAll(".qty").forEach(el => el.oninput = e => { items[e.target.dataset.i].qty = +e.target.value; updatePreview(); });
  list.querySelectorAll(".price").forEach(el => el.oninput = e => { items[e.target.dataset.i].price = +e.target.value; updatePreview(); });
  list.querySelectorAll(".remove").forEach(el => el.onclick = e => { items.splice(e.target.dataset.i,1); renderItemsForm(); updatePreview(); });
}
$("addItem").onclick = ()=>{ items.push({name:"Neues Produkt", qty:1, price:0}); renderItemsForm(); updatePreview(); };

$("logoInput").onchange = e=>{
  const file = e.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = () => { $("logoPreview").src = reader.result; $("logoPreview").style.display = "block"; };
  reader.readAsDataURL(file);
};

function fmt(n,c){return c+Number(n||0).toFixed(2);}
function updatePreview(){
  $("rShop").textContent = $("shopName").value;
  $("rAddr").innerHTML = $("address").value.replace(/\n/g,"<br>");
  $("rContact").textContent = $("contact").value;
  $("rDate").textContent = $("date").value;
  $("rTime").textContent = $("time").value;
  $("rCustomer").textContent = $("customer").value;
  $("rTrans").textContent = $("transId").value;

  const cur = $("currency").value;
  let subtotal=0;
  const itemsDiv = $("rItems");
  itemsDiv.innerHTML = "";
  items.forEach(it=>{
    const tot = it.qty*it.price;
    subtotal+=tot;
    const d=document.createElement("div");
    d.className="line";
    d.innerHTML=`<div>${it.name}</div><div>${fmt(tot,cur)}</div>`;
    itemsDiv.appendChild(d);
  });
  const tax=subtotal*($("tax").value/100);
  const total=subtotal+tax;
  $("rSubtotal").textContent=fmt(subtotal,cur);
  $("rTax").textContent=fmt(tax,cur);
  $("rTotal").textContent=fmt(total,cur);
}
["shopName","address","contact","date","time","customer","transId","tax","currency"].forEach(id=>$(id).oninput=updatePreview);
renderItemsForm(); updatePreview();

$("printBtn").onclick=()=>window.print();
$("pdfBtn").onclick=async()=>{
  const node=$("receipt");
  const canvas=await html2canvas(node,{scale:3});
  const img=canvas.toDataURL("image/png");
  const { jsPDF } = window.jspdf;
  const pdf=new jsPDF({unit:"mm",format:[80,canvas.height*0.2645]});
  pdf.addImage(img,"PNG",0,0,80,canvas.height*0.2645);
  pdf.save("receipt.pdf");
};
</script>
</body>
</html>
